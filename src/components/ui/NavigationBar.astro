---
// Header - Navigation bar
// ------------
// Description: navigation bars offer a persistent and convenient way to switch between primary destinations in an app.
// Structure:
// - Menu toggle: the mobile menu toggle of the navigation bar
// - Navigation Links: the navigation links of the menu
// - Theme Switcher: the mode (light/dark) switcher of the website
// Reference: https://wind-ui.com/components/navbars/

// Components
// - UI
import Switcher from './ModeSwitcher.astro'
import Badge from './Badge.astro'

// Content
// - Props
type Props = {
	type?: 'none' | 'sticky'
}
// -- Page Metadata
const { type = 'sticky' } = Astro.props

// - Data
import { getNavigationBarData } from '../../config/navigationBar'
const navigationBarData = await getNavigationBarData()
const { navItems } = navigationBarData

// - Determine current path
const path = new URL(Astro.request.url).pathname
function isActivePath(currentPath: string): boolean {
	return path === currentPath || path === `${currentPath}/`
}
---

<header class:list={['header', { [`header--${type}`]: type }]}>
	<div class="header__container">
		<nav aria-label="main navigation" role="navigation" class="header__nav">
			{/* Menu toggle */}
			<button
				id="header-toggle"
				class="header__toggle"
				aria-expanded="false"
				aria-label="Toggle navigation"
			>
				<div class="header__toggle-inner">
					<span aria-hidden="true"></span>
					<span aria-hidden="true"></span>
					<span aria-hidden="true"></span>
				</div>
			</button>
			{/* Navigation links */}
			<ul role="menubar" aria-label="Select page" class="header__menu">
				{
					navItems.map((item) => (
						<li role="none" class="header__menu-item">
							<a
								href={item.link}
								role="menuitem"
								class={`header__menu-link ${isActivePath(item.link) ? 'active' : ''}`}
							>
								{item.name}
								{item.badge && (
									<Badge name={item.badge} size="sm" classes="translate-x-1 -translate-y-1" />
								)}
							</a>
						</li>
					))
				}
			</ul>
			{/* Theme Switcher */}
			<Switcher />
		</nav>
	</div>
</header>

<script>
	// Function to close all menus
	function closeAllMenus() {
		// Remove 'open' class from all menu items
		document.querySelectorAll('.header__menu-item').forEach((item) => {
			item.classList.remove('open')
		})
		// Close mobile menu if open
		const menu = document.querySelector('.header__menu')
		const toggle = document.getElementById('header-toggle')
		if (menu && toggle && menu.classList.contains('header__menu--open')) {
			menu.classList.remove('header__menu--open')
			toggle.classList.remove('header__toggle--open')
			toggle.setAttribute('aria-expanded', 'false')
		}
	}

	// Function to initialize menu handlers
	function initMenuHandlers() {
		// Close all menus initially
		closeAllMenus()

		// Handle menu item clicks
		document.querySelectorAll('.header__menu-link').forEach((link) => {
			link.addEventListener('click', closeAllMenus)
		})
	}

	// Initialize on page load
	initMenuHandlers()

	// Re-initialize when Astro updates the page
	document.addEventListener('astro:after-swap', initMenuHandlers)

	// Handle hash changes
	window.addEventListener('hashchange', closeAllMenus)

	// Cleanup when component is destroyed
	document.addEventListener('astro:before-swap', () => {
		document.querySelectorAll('.header__menu-link').forEach((link) => {
			link.removeEventListener('click', closeAllMenus)
		})
	})
</script>

<style>
	.header {
		@apply sticky top-0 z-20 w-full before:absolute after:absolute after:left-0 after:top-full after:z-10 after:block after:h-px after:w-full lg:after:hidden;
	}
	.header:before {
		@apply block h-full w-full bg-transparent;
	}
	.header__container {
		@apply relative mx-auto px-6;
	}
	.header__nav {
		@apply flex h-[5.5rem] items-stretch justify-end gap-6 font-medium text-neutral-700 dark:text-neutral-50;
	}
	.header__menu {
		@apply invisible absolute left-0 top-0 z-[-1] ml-auto h-dvh w-full justify-center overflow-hidden overflow-y-auto overscroll-contain bg-white/90 px-8 py-[6rem] font-medium opacity-0 transition-[opacity,visibility] duration-300 dark:bg-neutral-950/90;
	}
	.header__menu--open {
		@apply visible opacity-100 backdrop-blur-sm;
	}
	.header__menu-item {
		@apply relative flex cursor-pointer flex-col items-stretch;
	}
	.header__menu-link {
		@apply relative flex items-center gap-1 py-4 transition-colors duration-300 hover:text-primary-500 focus:text-primary-600 focus:outline-none focus-visible:outline-none lg:justify-center [&.active]:text-primary-500;
	}
	.header__toggle {
		@apply relative order-10 block h-10 w-10 self-center [&--open]:visible [&--open]:opacity-100;
	}
	.header__toggle-inner {
		@apply absolute left-1/2 top-1/2 w-6 -translate-x-1/2 -translate-y-1/2 transform;
	}
	.header__toggle-inner span {
		@apply absolute block h-0.5 transform rounded-full bg-neutral-900 transition-all duration-300 dark:bg-white;
	}
	.header__toggle-inner span:nth-child(1) {
		@apply w-9/12 -translate-y-2 [.header\_\_toggle--open_&]:w-6 [.header\_\_toggle--open_&]:translate-y-0 [.header\_\_toggle--open_&]:rotate-45;
	}
	.header__toggle-inner span:nth-child(2) {
		@apply w-6 [.header\_\_toggle--open_&]:-rotate-45;
	}
	.header__toggle-inner span:nth-child(3) {
		@apply w-1/2 origin-top-left translate-y-2 [.header\_\_toggle--open_&]:w-0;
	}
</style>
